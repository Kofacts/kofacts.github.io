---
// src/pages/blog/[...slug].astro
import BlogPost from '../../layouts/BlogPost.astro';
import { fetchRSSPosts } from '../../utils/rss.js';

export async function getStaticPaths() {
    function extractFirstImage(htmlContent: string): string | null {
        if (!htmlContent) return null;
        
        const imgMatch = htmlContent.match(/<img[^>]+src="([^"]+)"/i);
        return imgMatch ? imgMatch[1] : null;
    }

    const posts = await fetchRSSPosts();

    return posts.map((post) => {
        const image = extractFirstImage(post.content);
        return {
            params: { slug: post.slug },
            props: {
                ...post,
                pubDate: post.date,
                image,
            },
        };
    });
}

const post = Astro.props;
---

<BlogPost 
    title={post.title}
    date={post.date}
    link={post.link}
    content={post.content}
    description={post.description}
    image={post.image}
/>